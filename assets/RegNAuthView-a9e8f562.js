import{_ as K,u as O,a as Q,b as X,o as E,r as o,s as b,c as F,d as h,e as f,f as l,t as s,g as y,h as a,i as p,w as L,j as B,k as r,F as Y,l as U}from"./index-7be76870.js";const Z={key:0,class:"step s0"},x={key:1,class:"step s1"},ee={action:""},te={class:"name"},le={class:"controls"},ae={key:2,class:"step s2"},oe={action:""},se={class:"input"},ne={class:"input"},ie={class:"controls"},re={key:3,class:"auth"},ue={action:""},ce={class:"controls"},me={__name:"RegNAuthView",setup(pe){const k=O(),{locale:$,t:u}=Q({}),N=X();E(()=>{localStorage.getItem("locale")?($.value=localStorage.getItem("locale"),N.value=u("titles.place")):($.value=navigator.language.slice(0,2),N.value=u("titles.place"),localStorage.setItem("locale",$.value))});const T=o(!0),c=o(!1),g=o(!1),w=o(!1),d=o(null),I=o(null),_=o(null),q=o(null),C=o(null),V=o(null),n=o(null),m=o(null),S=o(null);E(()=>{R(),D().then(e=>{e.session!=null?k.push("mobile"):setTimeout(()=>{T.value=!1,c.value=!0},3e3)})});async function D(){const{data:e,error:t}=await b.auth.getSession();return e}function j(){c.value=!0,g.value=!1}function P(){d.value.input.value.length<=3||d.value.input.value.length>=16?S.value.classList.add("length_error"):S.value.classList.remove("length_error")}function W(){w.value=!1,c.value=!0}function M(){w.value=!0,c.value=!1,g.value=!1}function z(){d.value.input.value.length!=0&&I.value.input.value.length!=0&&(localStorage.setItem("name",d.value.input.value),localStorage.setItem("bday",I.value.input.value),c.value=!1,g.value=!0)}function G(e,t){return Math.floor(Math.random()*(t-e+1)+e)}async function R(){let e=Math.floor(Math.random()*899999+1e5);const{data:t,error:A}=await b.from("profile").select("friend_code").eq("friend_code",e);if(t.length==0)return e}async function H(){if(_.value.input.value.length!=0&&C.value.input.value.length>=8){const{data:e,error:t}=await b.auth.signUp({email:_.value.input.value,password:C.value.input.value,options:{data:{name:localStorage.getItem("name"),bday:localStorage.getItem("bday"),language:localStorage.getItem("locale"),profile_image_number:G(1,10),friend_code:await R(),email:_.value.input.value}}});e.user!=null?(k.push("mobile"),localStorage.removeItem("name"),localStorage.removeItem("bday")):(console.log(t),t=="AuthApiError: User already registered"&&(n.value.textContent=u("mobile.errors.user_exist"),n.value.classList.add("anim"),setTimeout(()=>{n.value.classList.remove("anim")},6e3)),t=="AuthApiError: Unable to validate email address: invalid format"&&(n.value.textContent=u("mobile.errors.invalid_email"),n.value.classList.add("anim"),setTimeout(()=>{n.value.classList.remove("anim")},6e3)),t=='AuthApiError: new row for relation "profile" violates check constraint "profile_name_check"'&&(n.value.textContent=u("mobile.errors.invalid_name"),n.value.classList.add("anim"),setTimeout(()=>{n.value.classList.remove("anim")},6e3)))}}async function J(){const{data:e,error:t}=await b.auth.signInWithPassword({email:q.value.input.value,password:V.value.input.value});e.user!=null?k.push("mobile"):(m.value.classList.remove("hide"),t=="AuthApiError: Invalid login credentials"&&(m.value.textContent=u("mobile.errors.invalid_login"),setTimeout(()=>{m.value.classList.add("anim")},5e3),setTimeout(()=>{m.value.classList.add("hide"),m.value.classList.remove("anim")},6e3)))}return(e,t)=>{const A=F("router-link"),v=F("i18n-t");return h(),f(Y,null,[T.value?(h(),f("section",Z,[l("p",null,s(e.$t("mobile.hello")),1)])):y("",!0),c.value?(h(),f("section",x,[l("h1",null,s(e.$t("mobile.letsmeet")),1),l("form",ee,[l("div",te,[a(p,{onInput:t[0]||(t[0]=i=>P()),borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.name"),ref_key:"name",ref:d,type:"text",required:""},null,8,["placeholder"]),l("span",{ref_key:"name_length",ref:S},s(e.$t("mobile.inputs.hints.name")),513)]),a(p,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.bday"),ref_key:"bday",ref:I,type:"text",isDate:"",required:""},null,8,["placeholder"]),l("div",le,[a(B,{value:e.$t("mobile.inputs.buttons.next"),onClick:t[1]||(t[1]=L(i=>z(),["prevent"])),width:"222",height:"54"},null,8,["value"]),l("section",null,[a(v,{keypath:"mobile.misc.agreement.1",tag:"p",scope:"global"},{default:r(()=>[a(A,{to:"/terms"},{default:r(()=>[U(s(e.$t("mobile.misc.agreement.2")),1)]),_:1})]),_:1}),a(v,{keypath:"mobile.misc.account.1",tag:"p",scope:"global"},{default:r(()=>[l("span",{onClick:t[2]||(t[2]=i=>M())},s(e.$t("mobile.misc.account.2")),1)]),_:1})])])])])):y("",!0),g.value?(h(),f("section",ae,[l("h1",null,s(e.$t("mobile.few_more")),1),l("form",oe,[l("div",se,[a(p,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.email"),ref_key:"email_reg",ref:_,type:"email",required:""},null,8,["placeholder"]),l("span",null,s(e.$t("mobile.inputs.hints.mail")),1)]),l("div",ne,[a(p,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.password"),ref_key:"pass_reg",ref:C,type:"password",required:""},null,8,["placeholder"]),l("span",null,s(e.$t("mobile.inputs.hints.pass")),1)]),l("span",{class:"error",ref_key:"error_span_reg",ref:n},null,512),l("div",ie,[a(B,{value:e.$t("mobile.inputs.buttons.complete"),onClick:t[3]||(t[3]=L(i=>H(),["prevent"])),width:"222",height:"54"},null,8,["value"]),l("section",null,[a(v,{keypath:"mobile.misc.agreement.1",tag:"p",scope:"global"},{default:r(()=>[a(A,{to:"/terms"},{default:r(()=>[U(s(e.$t("mobile.misc.agreement.2")),1)]),_:1})]),_:1}),a(v,{keypath:"mobile.misc.account.1",tag:"p",scope:"global"},{default:r(()=>[l("span",{onClick:t[4]||(t[4]=i=>M())},s(e.$t("mobile.misc.account.2")),1)]),_:1})])])]),l("p",{class:"back_btn",onClick:t[5]||(t[5]=i=>j())},s(e.$t("mobile.misc.account.5")),1)])):y("",!0),w.value?(h(),f("section",re,[l("h1",null,s(e.$t("mobile.auth")),1),l("form",ue,[a(p,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.email"),ref_key:"email_auth",ref:q,type:"email",required:""},null,8,["placeholder"]),a(p,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.password"),ref_key:"pass_auth",ref:V,type:"password",required:""},null,8,["placeholder"]),l("span",{class:"error",ref_key:"error_span_auth",ref:m},null,512),l("div",ce,[a(B,{value:e.$t("mobile.inputs.buttons.signin"),onClick:t[6]||(t[6]=L(i=>J(),["prevent"])),width:"222",height:"54"},null,8,["value"]),l("section",null,[a(v,{keypath:"mobile.misc.account.3",scope:"global",tag:"p"},{default:r(()=>[l("span",{onClick:t[7]||(t[7]=i=>W())},s(e.$t("mobile.misc.account.4")),1)]),_:1})])])])])):y("",!0)],64)}}},ve=K(me,[["__scopeId","data-v-83df8196"]]);export{ve as default};
