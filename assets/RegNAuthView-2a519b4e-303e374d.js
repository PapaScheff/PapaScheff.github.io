import{Q as z,i as R,y as Y,B as Z,D,a as o,k as g,I as M,r as v,u as h,x as l,W as s,b as f,l as t,c as r,C as x,L as i,X as W,j as F,N as j}from"./index-8a5f7faf.js";const G={key:0,class:"step s0"},H={key:1,class:"step s1"},J={action:""},K={class:"controls"},O={key:2,class:"step s2"},ee={action:""},le={class:"input"},ae={class:"input"},te={class:"controls"},oe={key:3,class:"auth"},se={action:""},ie={class:"controls"},ne={__name:"RegNAuthView",setup(re){const y=R(),{locale:_,t:b}=Y({}),B=Z();D(()=>{localStorage.getItem("locale")?(_.value=localStorage.getItem("locale"),B.value=b("titles.place")):(_.value=navigator.language.slice(0,2),B.value=b("titles.place"),localStorage.setItem("locale",_.value))});const C=o(!0),u=o(!1),k=o(!1),$=o(!1),w=o(null),I=o(null),S=o(null),L=o(null),q=o(null),A=o(null),c=o(null),n=o(null);D(()=>{Q().then(e=>{e.session!=null?y.push("mobile"):setTimeout(()=>{C.value=!1,u.value=!0},3e3)})});async function Q(){const{data:e,error:a}=await g.auth.getSession();return e}function U(){$.value=!1,u.value=!0}function T(){$.value=!0,u.value=!1,k.value=!1}function X(){w.value.input.value.length!=0&&I.value.input.value.length!=0&&(localStorage.setItem("name",w.value.input.value),localStorage.setItem("bday",I.value.input.value),u.value=!1,k.value=!0)}function E(e,a){return Math.floor(Math.random()*(a-e+1)+e)}async function N(){const{data:e,error:a}=await g.from("profile").select("friend_code");let m=Math.floor(Math.random()*(1e7-0+1)+0);if(Number(e[0].friend_code)!=m)return m;N()}async function P(){const{data:e,error:a}=await g.auth.signUp({email:S.value.input.value,password:q.value.input.value,options:{data:{name:localStorage.getItem("name"),bday:localStorage.getItem("bday"),language:localStorage.getItem("locale"),profile_image_number:E(1,10),friend_code:N(),email:S.value.input.value}}});e.user!=null?(y.push("mobile"),localStorage.removeItem("name"),localStorage.removeItem("bday")):a=="AuthApiError: User already registered"&&(c.value.textContent=b("mobile.errors.user_exist"),setTimeout(()=>{c.value.classList.add("anim")},5e3),setTimeout(()=>{c.value.classList.add("hide"),c.value.classList.remove("anim")},6e3))}async function V(){const{data:e,error:a}=await g.auth.signInWithPassword({email:L.value.input.value,password:A.value.input.value});e.user!=null?y.push("mobile"):(n.value.classList.remove("hide"),a=="AuthApiError: Invalid login credentials"&&(n.value.textContent=b("mobile.errors.invalid_login"),setTimeout(()=>{n.value.classList.add("anim")},5e3),setTimeout(()=>{n.value.classList.add("hide"),n.value.classList.remove("anim")},6e3)))}return(e,a)=>{const m=M("router-link"),p=M("i18n-t");return v(),h(F,null,[C.value?(v(),h("section",G,[l("p",null,s(e.$t("mobile.hello")),1)])):f("",!0),u.value?(v(),h("section",H,[l("h1",null,s(e.$t("mobile.letsmeet")),1),l("form",J,[t(r,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.name"),ref_key:"name",ref:w,type:"text",required:""},null,8,["placeholder"]),t(r,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.bday"),ref_key:"bday",ref:I,type:"text",isDate:"",required:""},null,8,["placeholder"]),l("div",K,[t(x,{value:e.$t("mobile.inputs.buttons.next"),onClick:a[0]||(a[0]=d=>X()),width:"222",height:"54"},null,8,["value"]),l("section",null,[t(p,{keypath:"mobile.misc.agreement.1",tag:"p",scope:"global"},{default:i(()=>[t(m,{to:"/terms"},{default:i(()=>[j(s(e.$t("mobile.misc.agreement.2")),1)]),_:1})]),_:1}),t(p,{keypath:"mobile.misc.account.1",tag:"p",scope:"global"},{default:i(()=>[l("span",{onClick:a[1]||(a[1]=d=>T())},s(e.$t("mobile.misc.account.2")),1)]),_:1})])])])])):f("",!0),k.value?(v(),h("section",O,[l("h1",null,s(e.$t("mobile.few_more")),1),l("form",ee,[l("div",le,[t(r,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.email"),ref_key:"email_reg",ref:S,type:"email",required:""},null,8,["placeholder"]),l("span",null,s(e.$t("mobile.inputs.hints.mail")),1)]),l("div",ae,[t(r,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.password"),ref_key:"pass_reg",ref:q,type:"password",required:""},null,8,["placeholder"]),l("span",null,s(e.$t("mobile.inputs.hints.pass")),1),l("span",{class:"error",ref_key:"error_span_reg",ref:c},null,512)]),l("div",te,[t(x,{value:e.$t("mobile.inputs.buttons.complete"),onClick:a[2]||(a[2]=W(d=>P(),["prevent"])),width:"222",height:"54"},null,8,["value"]),l("section",null,[t(p,{keypath:"mobile.misc.agreement.1",tag:"p",scope:"global"},{default:i(()=>[t(m,{to:"/terms"},{default:i(()=>[j(s(e.$t("mobile.misc.agreement.2")),1)]),_:1})]),_:1}),t(p,{keypath:"mobile.misc.account.1",tag:"p",scope:"global"},{default:i(()=>[l("span",{onClick:a[3]||(a[3]=d=>T())},s(e.$t("mobile.misc.account.2")),1)]),_:1})])])])])):f("",!0),$.value?(v(),h("section",oe,[l("h1",null,s(e.$t("mobile.auth")),1),l("form",se,[t(r,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.email"),ref_key:"email_auth",ref:L,type:"email",required:""},null,8,["placeholder"]),t(r,{borderBottom:"",placeholder:e.$t("mobile.inputs.placeholders.password"),ref_key:"pass_auth",ref:A,type:"password",required:""},null,8,["placeholder"]),l("span",{class:"error",ref_key:"error_span_auth",ref:n},null,512),l("div",ie,[t(x,{value:e.$t("mobile.inputs.buttons.signin"),onClick:a[4]||(a[4]=W(d=>V(),["prevent"])),width:"222",height:"54"},null,8,["value"]),l("section",null,[t(p,{keypath:"mobile.misc.account.3",scope:"global",tag:"p"},{default:i(()=>[l("span",{onClick:a[5]||(a[5]=d=>U())},s(e.$t("mobile.misc.account.4")),1)]),_:1})])])])])):f("",!0)],64)}}},ce=z(ne,[["__scopeId","data-v-529888a2"]]);export{ce as default};
